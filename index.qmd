---
title: "Estimate the risk of outbreaks"
author: "Ong Phuc Thinh"
format:
  revealjs:
    scrollable: true
    chalkboard: true
    code-fold: true
    callout-appearance: simple
    callout-icon: false
    slide-number: true
---

## Based on these papers

-   Southall E, Ogi-Gittins Z, Kaye AR, Hart WS, Lovell-Read FA, **Thompson RN**. A practical guide to mathematical methods for estimating infectious disease outbreak risks. Journal of Theoretical Biology. 2023 Jan 20:111417. <https://doi.org/10.1016/j.jtbi.2023.111417>

-   Sachak-Patwa R, Byrne HM, Dyson L, **Thompson RN**. The risk of SARS-CoV-2 outbreaks in low prevalence settings following the removal of travel restrictions. Communications Medicine. 2021 Oct 15;1(1):39. <https://doi.org/10.1038/s43856-021-00038-8>

## Same corresponding author

::: {layout-ncol=2}

![](img/robin.jpg)

* [**Robin Thompson**](https://www.robin-thompson.co.uk/)

* *Associate Professor of Applied Mathematics*

* Mathematics Institute, University of Warwick

* PhD in Mathematical Epidemiology, University of Cambridge

:::

## Compartmental outbreak models (1)

```{mermaid}
%%| fig-width: 6

flowchart LR
  S["S(t)"] --βI/N--> I["I(t)"]
  I --γ--> R["R(t)"]
```

-   $\beta$: infection rate
-   $\gamma$: removal rate

## Compartmental outbreak models (2)

* **Randomness** in contacts between individuals is important for determining whether or not a major outbreak occurs

* Deterministic model is **inappropriate**

* Instead, use stochastic model

## Stochastic SIR models (1)

```{mermaid}
%%| fig-width: 6

flowchart LR
  S["S(t)"] --βI/N--> I["I(t)"]
  I --γ--> R["R(t)"]
```

**Gillespie algorithm**

2 possible events:

-   $\mathbb{P}\text{(infection event)} = \frac{\beta \frac{I(t)}{N} S(t)}{\beta \frac{I(t)}{N} S(t) + \gamma I(t)}$
-   $\mathbb{P}\text{(removal event)} = \frac{\gamma I(t)}{\beta \frac{I(t)}{N} S(t) + \gamma I(t)}$

## Stochastic SIR models (2)

Early stage:

$I(t) = 1$, $S(t) \approx N$

$\mathbb{P}\text{(infection event)} = \frac{\beta \frac {I(t)} {N} S(t)}{\beta \frac {I(t)} {N} S(t) + \gamma I(t)} \approx \frac {\beta} {\beta + \gamma}$

$\mathbb{P}\text{(removal event)} = \frac {\gamma I(t)} {\beta \frac {I(t)} {N} S(t) + \gamma I(t)} \approx \frac {\gamma} {\beta + \gamma}$

## Stochastic SIR models (3)

Probability that 1 infected host generates k infections is:

$$\mathbb{P}(X = k) = \left( \frac{\beta}{\beta + \gamma} \right)^k \times \frac{\gamma}{\beta + \gamma}$$

* First generate k infections

* Then be removed

* The number of failures prior to the first success

* A **geometric distribution** with "success probability" $\frac {\gamma} {\beta + \gamma}$

## Methods for estimating the probability of a major outbreak

Two methods:

* Probability generating functions

* First-step analysis

## Probability generating functions (1)

The early outbreak can be approximated as a **branching process**:

* Each infected individual generates a number of new infections that is drawn from the **offspring distribution**

* Assumption: All infected cases **independently** generate secondary cases (independently draws from the **offspring distribution**)

* The **offspring distribution** is **geometric distribution** (explained above)

## Galton-Watson branching process (1)

::: {layout-ncol=2}

![](img/branching_process.jpg)

* Ignore the precise times at which infections occur

* Infections can be separated into discrete generations

* **All infections generated by a specific individual** appear in the **same generation**.

:::

## Galton-Watson branching process (2)

![](img/galton_watson.png){fig-align="center"}

* Start with 1 individual at generation n = 0.

* Each individual lives 1 generation, has $Y$ offspring, and dies.

* $Y$ takes values 0, 1, 2, ..., and the probability of producing $k$ offspring is $\mathbb{P}(Y = k) = p_k$.

## Galton-Watson branching process (3)

![](img/offspring_distr.png){fig-align="center"}

* All individuals reproduce **independently**.

* Individuals 1, 2, ..., n have family sizes $Y_1$, $Y_2$, ..., $Y_n$, where each $Y_i$ has **the same offspring distribution** as $Y$.

## Probability generating functions (2)

Probability generating function (PGF) is useful to deal with sums and limits of **discrete** random variables.

$$G_X(s) = \mathbb{E}(s^X) = \sum_{x = 0}^\infty s^x \mathbb{P}(X = x)$$

$$G_X(s) = s^0 \mathbb{P}(X = 0) + s^1 \mathbb{P}(X = 1) + s^2 \mathbb{P}(X = 2) + ...$$

PGF is a function that can **generate all probabilities of the distribution**.

## Calculate probabilities with PGF (1)

Let $p_0 = \mathbb{P}(X = 0)$, $p_1 = \mathbb{P}(X = 1)$...

$$G_X(s) = s^0 p_0 + s^1 p_1 + s^2 p_2 + s^3 p_3 + s^4 p_4 ...$$

If $s = 0$, then $G(0) = 0^0 p_0 + 0^1 p_1 + 0^2 p_2 + 0^3 p_3 + ...$

Because $0^0 = 1$ and $0^1 = 0^2 = 0^3 = ... = 0$

Therefore $G(0) = p_0$

## Calculate probabilities with PGF (2)

$$G_X(s) = s^0 p_0 + s^1 p_1 + s^2 p_2 + s^3 p_3 + s^4 p_4 ...$$

First derivative: $G'_X(s) = p_1 + 2 p_2 s + 3 p_3 s^2 + 4 p_4 s^3 ...$

If $s = 0$, then $G'_X(0) = p_1$

Second derivative: $G''_X(s) = 2 p_2 + 6 p_3 s + 12 p_4 s^2 ...$

If $s = 0$, then $G''_X(0) = 2 p_2$ or $p_2 = \frac{G''_X(0)}{2}$

## PGF of geometric distribution



## Extinction probability

$$q_n = \mathbb{P}\text{(extinct by generation n)} = \mathbb{P}(Z_n = 0)$$

$$q = q_\infty = \mathbb{P}\text{(ultimate extinction)} = \mathbb{P}(\lim_{n\to\infty} Z_n) = \lim_{n\to\infty}\mathbb{P}(Z_n) = \lim_{n\to\infty} q_n$$

**Theorem**

Let q be the probability of ultimate extinction. Then q is the smallest non-negative solution of the equation $G(q) = q$ (or the fixed point).

$1 + r + r^2 + r^3 + ... = \sum_{x=0}^{\infty} r^x = \frac {1} {1 - r}$ with $|r| < 1$

Prove this:

$S = 1 + r + r^2 + r^3 + ...$

$rS = r + r^2 + r^3 + r^4 + ...$

$\Rightarrow S - rS = 1 \Leftrightarrow S(1 - r) = 1 \Leftrightarrow S = \frac {1} {1 - r}$

## Why $G(q) = q$? (1)

**Lemma:** Let $q_n = \mathbb{P}(Z_n = 0)$ (probability of extinction by generation n). Then $q_n = G(q_{n - 1})$

**Proof:**

$G_n(s)$ is the PGF of $Z_n$, then $G_n(0) = \mathbb{P}(Z_n = 0)$

::: {.callout-note collapse=true}
$G_X(s) = \mathbb{E}(s^X) = \sum_{x=0}^{\infty} s^x \mathbb{P}(X = x)$

$G_X(0) = \mathbb{E}(s^0) = \sum_{x=0}^{\infty} s^0 \mathbb{P}(X = 0) = \mathbb{P}(X = 0)$ (because $s^0 = 1$)
:::

So $q_n = \mathbb{P}(Z_n = 0) = G_n(0)$. Similarly, $q_{n - 1} = \mathbb{P}(Z_{n - 1} = 0) = G_{n - 1}(0)$

Now $G_n(0) = \underbrace{G(G(G(...G}_\text{n times}(0)...))) = G(G_{n - 1}(0))$

Because $q_{n - 1} = G_{n - 1}(0)$

So $q_n = G_n(0) = G(G_{n - 1}(0)) = G(q_{n - 1})$

## Why $G(q) = q$? (2)



## $SI_{n}R$

```{r}
#| code-fold: true
#| echo: true
solve_q <- function(R0, n){
  # define the equation
  f <- function(q) (1 / ((R0 / n) + 1 - q * (R0 / n))^n) - q
  
  # use uniroot function to find the root of the equation
  result <- uniroot(f, lower=0, upper=0.999)$root
  
  return(result)
}

R0 <- 2
n <- seq(0.001, 5, 0.001)
q <- numeric(length(n))

for (i in 1:length(n)){
  q[i] <- solve_q(R0, n[i])
}

plot(n, 1-q, type="l", xlab="n", ylab="1-q", 
     xlim = c(0, 5), ylim = c(0, 0.8))
```

# Metrics for assessing the risk of outbreaks

## Instantaneous Outbreak Risk (IOR)

The risk that an imported case initiates an outbreak as opposed to the virus simply fading out, under the assumption that **pathogen transmissibility is fixed** at its value when the imported case enters the population

## Case Outbreak Risk (COR)

## Simulated Outbreak Risk (SOR)

Simulating the stochastic model 10,000 times starting from 1 infected individual

SOR = the proportion of simulations in which the number of infected hosts exceeds a pre-defined threshold value (e.g. 100 cases)

## Numerical Outbreak Risk (NOR)

## Acknowledgements

Somya Mehra: for very intuitive explanation of stochastic processes
